<!DOCTYPE html>
<html>
<head>
    #set($pageTitle = $i18n.get("title.config.management"))
    #parse("blocks/html-head.vm")
</head>
<body class="hold-transition sidebar-mini">
<!-- Site wrapper -->
<div class="wrapper">
    #parse("blocks/navbar.vm")

    #set($currentPage = "config")
    #parse("blocks/sidebar.vm")

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <div class="container-fluid">
                <div class="row mb-2">
                    <div class="col-sm-6">
                        <h1>$i18n.get("title.config.management")</h1>
                    </div>
                    <div class="col-sm-6">
                        <ol class="breadcrumb float-sm-right">
                            <li class="breadcrumb-item"><a href="#">$i18n.get("page.home")</a></li>
                            <li class="breadcrumb-item active">$i18n.get("title.config.management")</li>
                        </ol>
                    </div>
                </div>
            </div><!-- /.container-fluid -->
        </section>

        <!-- Main content -->
        <section class="content">
            <!-- Configæ¨é€è°ƒè¯•é¢æ¿ -->
            <div class="row">
                <div class="col-12">
                    <div id="config-debug-panel" class="card card-warning collapsed-card" style="display:none;">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fa fa-bug"></i> Configæ¨é€è°ƒè¯•é¢æ¿
                            </h3>
                            <div class="card-tools">
                                <button type="button" class="btn btn-warning btn-sm" data-card-widget="collapse">
                                    <i class="fa fa-plus"></i>
                                </button>
                                <button type="button" class="btn btn-warning btn-sm" onclick="clearDebugLog()">
                                    <i class="fa fa-trash"></i> æ¸…ç©º
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h5>ğŸ“‹ æ¨é€å‚æ•°</h5>
                                    <div id="push-params-display" class="debug-content">
                                        <p class="text-muted">ç‚¹å‡»æ¨é€æŒ‰é’®æ—¶æ˜¾ç¤ºå‚æ•°</p>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h5>ğŸ“‹ æ¨¡å—åŒ¹é…ç»“æœ</h5>
                                    <div id="module-match-display" class="debug-content">
                                        <p class="text-muted">æ˜¾ç¤ºåŒ¹é…çš„æ¨¡å—åˆ—è¡¨</p>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col-md-12">
                                    <h5>ğŸ“ è°ƒè¯•æ—¥å¿—</h5>
                                    <div id="debug-log-display" class="debug-log">
                                        <!-- å®æ—¶è°ƒè¯•æ—¥å¿— -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-12">
                    <div class="card card-blue card-outline">
                        <div class="card-header border-0">
                            <h5 class="card-title text-blue">
                                $i18n.get("title.config.management") <i class="fa fa-cogs"></i>
                            </h5>
                            <div class="card-tools">
                            <div class="btn-group float-right" role="group" style="margin-right: 10px;">
                                <button type="button" class="btn btn-info btn-sm" onclick="openEnvironmentChecker()">
                                    <i class="fa fa-check-circle"></i> Environmentæ£€æŸ¥å™¨
                                </button>
                                <button type="button" class="btn btn-warning btn-sm" onclick="toggleConfigDebugPanel()">
                                    <i class="fa fa-bug"></i> è°ƒè¯•é¢æ¿
                                </button>
                                <button type="button" class="btn btn-secondary btn-sm" onclick="openDatabaseDebugger()">
                                    <i class="fa fa-database"></i> æ•°æ®åº“è°ƒè¯•
                                </button>
                                <button type="button" class="btn btn-danger btn-sm" onclick="openK8sDebugger()">
                                    <i class="fa fa-cloud"></i> K8Sè°ƒè¯•
                                </button>
                            </div>
                                <a href="/config/add.htm" target="_blank" class="btn btn-primary btn-sm float-right"
                                        data-loading-text="searching">
                                    $i18n.get("button.add.config")
                                </a>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-lg-12">
                                    <form class="form-inline" method="get" action="list.htm">
                                        <div class="form-group" style="margin-left:10px">
                                            <label for="appName">$i18n.get("label.app.name"):</label>
                                            <input type="text" class="form-control" placeholder="$i18n.get('label.app.name')" 
                                                   name="appName" value="$!requestParams.appName" autocomplete="off"
                                                   data-toggle="tooltip" title="$i18n.get('label.app.name')" 
                                                   style="width: 210px;margin-left:10px">
                                        </div>
                                        <div class="form-group" style="margin-left: 10px">
                                            <label for="environment">$i18n.get("label.environment"):</label>
                                            <input type="text" class="form-control" placeholder="$i18n.get('label.environment')" 
                                                   name="environment" value="$!requestParams.environment" autocomplete="off"
                                                   data-toggle="tooltip" title="$i18n.get('label.environment')" 
                                                   style="width: 210px;margin-left:10px">
                                        </div>
                                        <div class="form-group" style="margin-left: 20px">
                                            <button type="submit" class="btn btn-primary"
                                                    data-loading-text="searching" id="search-online-btn">
                                                $i18n.get("button.query") <i class="fa fa-search icon-on-right bigger"></i>
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            <table class="table table-hover table-striped" style="word-break: break-all;">
                                #if($pagerWrapper.content && $pagerWrapper.content.size() > 0)
                                    <thead>
                                    <tr>
                                        <th>$i18n.get("table.app.name")</th>
                                        <th>$i18n.get("table.environment")</th>
                                        <th>$i18n.get("form.config.model")</th>
                                        <th>$i18n.get("table.create.time")</th>
                                        <th>$i18n.get("table.modify.time")</th>
                                        <th width="150px">$i18n.get("table.operation")</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                        #foreach($data in $pagerWrapper.content)
                                        <tr>
                                            <td style="vertical-align: middle">$!data.appName</td>
                                            <td style="vertical-align: middle">$!{data.environment}</td>
                                            <td style="vertical-align: middle">$!data.configModel</td>
                                            <td style="vertical-align: middle">$!{data.gmtCreate}</td>
                                            <td style="vertical-align: middle">$!{data.gmtModified}</td>
                                            <td style="vertical-align: middle">
                                                <a href="/config/detail.htm?appName=$!{data.appName}&environment=$!{data.environment}" 
                                                   class="btn btn-primary btn-xs" data-toggle="tooltip"
                                                   title="$i18n.get('button.detail')" data-env="$!{data.environment}"
                                                   data-app="$!{data.appName}">$i18n.get("button.detail")
                                                </a>
                                                <a href="/config/edit.htm?appName=$!{data.appName}&environment=$!{data.environment}" 
                                                   class="btn btn-info btn-xs" data-toggle="tooltip"
                                                   title="$i18n.get('button.edit')" data-env="$!{data.environment}"
                                                   data-app="$!{data.appName}">$i18n.get("button.edit")
                                                </a>
                                                <button class="btn btn-success btn-xs btn-push" data-toggle="tooltip"
                                                        title="$i18n.get('button.push')" data-env="$!{data.environment}"
                                                        data-app="$!{data.appName}">$i18n.get("button.push")
                                                </button>
                                            </td>
                                        </tr>
                                        #end
                                    </tbody>
                                #else
                                    <h5 style="padding-left: 10px;margin-top: 20px">$i18n.get("msg.no.config")</h5>
                                #end
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->

    #parse("blocks/footer.vm")
</div>
<!-- ./wrapper -->

#parse("blocks/header-scripts.vm")
#parse("blocks/fakeloader.vm")

<script type="application/javascript">
    // é¿å…ä¸Velocityçš„$ç¬¦å·å†²çª
    var jq = jQuery.noConflict();
    
    // ==================== å…¨å±€å‡½æ•°å®šä¹‰ (ä¾›HTML onclickè°ƒç”¨) ====================
    
    window.toggleConfigDebugPanel = function() {
            var panel = jq('#config-debug-panel');
            if (panel.is(':visible')) {
                panel.hide();
            } else {
                panel.show();
                if (panel.hasClass('collapsed-card')) {
                    panel.find('[data-card-widget="collapse"]').click();
                }
            }
        };
        
        function showConfigDebugPanel() {
            jq('#config-debug-panel').show();
            if (jq('#config-debug-panel').hasClass('collapsed-card')) {
                jq('#config-debug-panel').find('[data-card-widget="collapse"]').click();
            }
        }
        
        function logPushParams(appName, environment) {
            var params = {
                appName: appName,
                environment: environment,
                timestamp: new Date().toLocaleString()
            };
            
            var html = '<div class="param-item">' +
                '<strong>åº”ç”¨å:</strong> <span class="text-primary">' + appName + '</span><br>' +
                '<strong>ç¯å¢ƒ:</strong> <span class="text-info">' + environment + '</span><br>' +
                '<strong>æ—¶é—´:</strong> <span class="text-muted">' + params.timestamp + '</span>' +
                '</div>';
            
            jq('#push-params-display').html(html);
            addDebugLog('[PUSH]', 'å¼€å§‹æ¨é€Config - AppName: ' + appName + ', Environment: ' + environment);
        }
        
        function checkModuleMatches(appName, environment, callback) {
            addDebugLog('[QUERY]', 'æ­£åœ¨æŸ¥è¯¢åŒ¹é…çš„æ¨¡å—...');
            
            jq.ajax({
                url: '/config/checkMatches.json',
                method: 'GET',
                data: { appName: appName, environment: environment },
                success: function(response) {
                    if (response.success) {
                        callback(response.data);
                    } else {
                        callback({
                            hasMatches: false,
                            reason: 'api_error',
                            suggestions: [response.message],
                            matchCount: 0,
                            availableEnvironments: []
                        });
                    }
                },
                error: function() {
                    callback({
                        hasMatches: false,
                        reason: 'network_error',
                        suggestions: ['æ£€æŸ¥ç½‘ç»œè¿æ¥', 'é‡è¯•æ“ä½œ'],
                        matchCount: 0,
                        availableEnvironments: []
                    });
                }
            });
        }
        
        function logModuleMatches(matchResult) {
            var html = '';
            if (matchResult.hasMatches) {
                html = '<div class="alert alert-success">' +
                    '<strong>[OK] æ‰¾åˆ° ' + matchResult.matchCount + ' ä¸ªåŒ¹é…çš„æ¨¡å—</strong>' +
                    '</div>' +
                    '<div class="mt-2">' +
                    '<small class="text-muted">åŒ¹é…çš„æ¨¡å—å°†æ¥æ”¶Configæ¨é€</small>' +
                    '</div>';
                addDebugLog('[OK]', 'æ‰¾åˆ° ' + matchResult.matchCount + ' ä¸ªåŒ¹é…çš„æ¨¡å—');
            } else {
                var envBadges = '';
                for (var i = 0; i < matchResult.availableEnvironments.length; i++) {
                    envBadges += '<span class="badge badge-secondary mr-1">' + matchResult.availableEnvironments[i] + '</span>';
                }
                
                html = '<div class="alert alert-danger">' +
                    '<strong>[ERROR] æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ¨¡å—</strong>' +
                    '</div>' +
                    '<div class="mt-2">' +
                    '<strong>åŸå› :</strong> <span class="text-danger">' + getReasonText(matchResult.reason) + '</span><br>' +
                    '<strong>å¯ç”¨çš„Environments:</strong><br>' +
                    envBadges +
                    '</div>';
                addDebugLog('[ERROR]', 'æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ¨¡å— - ' + getReasonText(matchResult.reason));
            }
            
            jq('#module-match-display').html(html);
        }
        
        function getReasonText(reason) {
            switch(reason) {
                case 'no_modules': return 'è¯¥åº”ç”¨æ²¡æœ‰æ³¨å†Œä»»ä½•æ¨¡å—';
                case 'environment_mismatch': return 'Environmentä¸åŒ¹é…';
                case 'api_error': return 'APIè°ƒç”¨é”™è¯¯';
                case 'network_error': return 'ç½‘ç»œè¿æ¥é”™è¯¯';
                default: return 'æœªçŸ¥åŸå› ';
            }
        }
        
        function executePushConfig(appName, environment) {
            addDebugLog('[START]', 'å¼€å§‹æ‰§è¡ŒConfigæ¨é€...');
            showLoading(10);
            
            jq.ajax({
                type: 'POST',
                url: "//" + host + "/config/push.json",
                data: {
                    "appName": appName,
                    "environment": environment,
                },
                success: function (res) {
                    hideLoading(10);
                    if (res.success) {
                        addDebugLog('[SUCCESS]', 'Configæ¨é€æˆåŠŸ: ' + res.message);
                    } else {
                        addDebugLog('[FAIL]', 'Configæ¨é€å¤±è´¥: ' + res.message);
                    }
                    notice(res.message, res.success);
                },
                dataType: 'json',
                error: function (XMLHttpRequest) {
                    hideLoading(10);
                    addDebugLog('[EXCEPTION]', 'Configæ¨é€å¼‚å¸¸: ' + XMLHttpRequest.responseText);
                    notice(JSON.stringify(XMLHttpRequest), false);
                }
            });
        }
        
        function showNoMatchReason(reason, suggestions) {
            var suggestionHtml = '';
            for (var i = 0; i < suggestions.length; i++) {
                suggestionHtml += '<li>' + suggestions[i] + '</li>';
            }
            
            var alertHtml = '<div class="alert alert-warning">' +
                '<h5><i class="fa fa-exclamation-triangle"></i> æ— æ³•æ¨é€Config</h5>' +
                '<p><strong>åŸå› :</strong> ' + getReasonText(reason) + '</p>' +
                '<p><strong>å»ºè®®:</strong></p>' +
                '<ul>' + suggestionHtml + '</ul>' +
                '</div>';
            
            jq("#danger-message-area").html(alertHtml);
            jq("#danger-modal").modal('show');
        }
        
        function addDebugLog(icon, message) {
            var timestamp = new Date().toLocaleTimeString();
            var logEntry = '<div class="debug-log-entry">' +
                '<span class="text-muted">[' + timestamp + ']</span> ' +
                '<span>' + icon + '</span> ' +
                '<span>' + message + '</span>' +
                '</div>';
            
            var jqlogDisplay = jq('#debug-log-display');
            jqlogDisplay.append(logEntry);
            jqlogDisplay.scrollTop(jqlogDisplay[0].scrollHeight);
        }
        
        window.clearDebugLog = function() {
            jq('#debug-log-display').empty();
            jq('#push-params-display').html('<p class=\"text-muted\">ç‚¹å‡»æ¨é€æŒ‰é’®æ—¶æ˜¾ç¤ºå‚æ•°</p>');
            jq('#module-match-display').html('<p class=\"text-muted\">æ˜¾ç¤ºåŒ¹é…çš„æ¨¡å—åˆ—è¡¨</p>');
        };
        
        // ==================== æ–¹æ¡ˆ2ï¼šEnvironmentä¸€è‡´æ€§æ£€æŸ¥å™¨å‡½æ•° ====================
        
        window.openEnvironmentChecker = function() {
            if (!jq('#environment-checker-modal').length) {
                createEnvironmentCheckerModal();
            }
            jq('#environment-checker-modal').modal('show');
            runEnvironmentCheck();
        };
        
        window.autoFixEnvironments = function() {
            if (confirm('ç¡®å®šè¦è‡ªåŠ¨ä¿®å¤Environmentä¸åŒ¹é…çš„é—®é¢˜å—ï¼Ÿè¿™å°†ä¿®æ”¹Configè¡¨ä¸­çš„environmentå­—æ®µã€‚')) {
                jq.ajax({
                    url: '/config/autoFixEnvironments.json',
                    method: 'POST',
                    success: function(response) {
                        if (response.success) {
                            notice('è‡ªåŠ¨ä¿®å¤å®Œæˆ: ' + response.message, true);
                            runEnvironmentCheck(); // é‡æ–°æ£€æŸ¥
                        } else {
                            notice('è‡ªåŠ¨ä¿®å¤å¤±è´¥: ' + response.message, false);
                        }
                    },
                    error: function() {
                        notice('è‡ªåŠ¨ä¿®å¤è¯·æ±‚å¤±è´¥', false);
                    }
                });
            }
        };
        
        // ==================== æ•°æ®åº“è°ƒè¯•å™¨å‡½æ•° ====================
        
        window.openDatabaseDebugger = function() {
            if (!jq('#database-debugger-modal').length) {
                createDatabaseDebuggerModal();
            }
            jq('#database-debugger-modal').modal('show');
        };
        
        function createDatabaseDebuggerModal() {
            var modalHtml = '<div class="modal fade" id="database-debugger-modal" tabindex="-1">' +
                '<div class="modal-dialog modal-xl">' +
                '<div class="modal-content">' +
                '<div class="modal-header">' +
                '<h4 class="modal-title"><i class="fa fa-database"></i> æ•°æ®åº“è°ƒè¯•å™¨</h4>' +
                '<button type="button" class="close" data-dismiss="modal">' +
                '<span aria-hidden="true">Ã—</span>' +
                '</button>' +
                '</div>' +
                '<div class="modal-body">' +
                '<div class="row">' +
                '<div class="col-md-6">' +
                '<h5><i class="fa fa-cog"></i> Configæ•°æ®</h5>' +
                '<button class="btn btn-primary btn-sm" onclick="queryAllConfigs()">æŸ¥è¯¢æ‰€æœ‰Config</button>' +
                '<div id="config-data-display" class="mt-3">' +
                '<p class="text-muted">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æŸ¥è¯¢Configæ•°æ®</p>' +
                '</div>' +
                '</div>' +
                '<div class="col-md-6">' +
                '<h5><i class="fa fa-server"></i> Moduleæ•°æ®</h5>' +
                '<button class="btn btn-info btn-sm" onclick="queryAllModules()">æŸ¥è¯¢æ‰€æœ‰Module</button>' +
                '<div id="module-data-display" class="mt-3">' +
                '<p class="text-muted">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æŸ¥è¯¢Moduleæ•°æ®</p>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '<div class="row mt-4">' +
                '<div class="col-12">' +
                '<h5><i class="fa fa-search"></i> åŒ¹é…åˆ†æ</h5>' +
                '<div class="form-group">' +
                '<label>åº”ç”¨åç§°:</label>' +
                '<input type="text" id="debug-app-name" class="form-control" placeholder="è¾“å…¥åº”ç”¨åç§°">' +
                '</div>' +
                '<div class="form-group">' +
                '<label>ç¯å¢ƒ:</label>' +
                '<input type="text" id="debug-environment" class="form-control" placeholder="è¾“å…¥ç¯å¢ƒåç§°">' +
                '</div>' +
                '<button class="btn btn-warning" onclick="analyzeMatching()">åˆ†æåŒ¹é…æƒ…å†µ</button>' +
                '<div id="matching-analysis-display" class="mt-3">' +
                '<p class="text-muted">å¡«å†™åº”ç”¨åç§°å’Œç¯å¢ƒåç‚¹å‡»åˆ†æ</p>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '<div class="modal-footer">' +
                '<button type="button" class="btn btn-secondary" data-dismiss="modal">å…³é—­</button>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>';
            jq('body').append(modalHtml);
        }
        
        window.queryAllConfigs = function() {
            jq('#config-data-display').html('<i class="fa fa-spinner fa-spin"></i> æŸ¥è¯¢ä¸­...');
            jq.ajax({
                url: '/config/debugQuery.json',
                method: 'GET',
                success: function(response) {
                    if (response.success && response.data) {
                        displayConfigData(response.data);
                    } else {
                        jq('#config-data-display').html('<p class="text-danger">æŸ¥è¯¢å¤±è´¥: ' + (response.message || 'æœªçŸ¥é”™è¯¯') + '</p>');
                    }
                },
                error: function() {
                    jq('#config-data-display').html('<p class="text-danger">æŸ¥è¯¢è¯·æ±‚å¤±è´¥</p>');
                }
            });
        };
        
        window.queryAllModules = function() {
            jq('#module-data-display').html('<i class="fa fa-spinner fa-spin"></i> æŸ¥è¯¢ä¸­...');
            jq.ajax({
                url: '/module/debugQuery.json',
                method: 'GET',
                success: function(response) {
                    if (response.success && response.data) {
                        displayModuleData(response.data);
                    } else {
                        jq('#module-data-display').html('<p class="text-danger">æŸ¥è¯¢å¤±è´¥: ' + (response.message || 'æœªçŸ¥é”™è¯¯') + '</p>');
                    }
                },
                error: function() {
                    jq('#module-data-display').html('<p class="text-danger">æŸ¥è¯¢è¯·æ±‚å¤±è´¥</p>');
                }
            });
        };
        
        window.analyzeMatching = function() {
            var appName = jq('#debug-app-name').val().trim();
            var environment = jq('#debug-environment').val().trim();
            
            if (!appName || !environment) {
                jq('#matching-analysis-display').html('<p class="text-warning">è¯·å¡«å†™åº”ç”¨åç§°å’Œç¯å¢ƒ</p>');
                return;
            }
            
            jq('#matching-analysis-display').html('<i class="fa fa-spinner fa-spin"></i> åˆ†æä¸­...');
            jq.ajax({
                url: '/config/debugMatching.json',
                method: 'GET',
                data: { appName: appName, environment: environment },
                success: function(response) {
                    if (response.success && response.data) {
                        displayMatchingAnalysis(response.data);
                    } else {
                        jq('#matching-analysis-display').html('<p class="text-danger">åˆ†æå¤±è´¥: ' + (response.message || 'æœªçŸ¥é”™è¯¯') + '</p>');
                    }
                },
                error: function() {
                    jq('#matching-analysis-display').html('<p class="text-danger">åˆ†æè¯·æ±‚å¤±è´¥</p>');
                }
            });
        };
        
        function displayConfigData(configs) {
            if (!configs || configs.length === 0) {
                jq('#config-data-display').html('<p class="text-warning">æ²¡æœ‰æ‰¾åˆ°Configæ•°æ®</p>');
                return;
            }
            
            var html = '<table class="table table-sm table-striped">' +
                '<thead><tr><th>åº”ç”¨å</th><th>ç¯å¢ƒ</th><th>åˆ›å»ºæ—¶é—´</th></tr></thead>' +
                '<tbody>';
            configs.forEach(function(config) {
                html += '<tr>' +
                    '<td><code>' + (config.appName || 'N/A') + '</code></td>' +
                    '<td><code>' + (config.environment || 'N/A') + '</code></td>' +
                    '<td>' + (config.gmtCreate || 'N/A') + '</td>' +
                    '</tr>';
            });
            html += '</tbody></table>';
            jq('#config-data-display').html(html);
        }
        
        function displayModuleData(modules) {
            if (!modules || modules.length === 0) {
                jq('#module-data-display').html('<p class="text-warning">æ²¡æœ‰æ‰¾åˆ°Moduleæ•°æ®</p>');
                return;
            }
            
            var html = '<table class="table table-sm table-striped">' +
                '<thead><tr><th>åº”ç”¨å</th><th>ç¯å¢ƒ</th><th>IP</th><th>çŠ¶æ€</th><th>å¿ƒè·³æ—¶é—´</th></tr></thead>' +
                '<tbody>';
            modules.forEach(function(module) {
                html += '<tr>' +
                    '<td><code>' + (module.appName || 'N/A') + '</code></td>' +
                    '<td><code>' + (module.environment || 'N/A') + '</code></td>' +
                    '<td>' + (module.ip || 'N/A') + '</td>' +
                    '<td>' + (module.status || 'N/A') + '</td>' +
                    '<td>' + (module.gmtModified || 'N/A') + '</td>' +
                    '</tr>';
            });
            html += '</tbody></table>';
            jq('#module-data-display').html(html);
        }
        
        function displayMatchingAnalysis(analysis) {
            var html = '<div class="alert alert-info">' +
                '<h6><i class="fa fa-info-circle"></i> åŒ¹é…åˆ†æç»“æœ</h6>' +
                '<p><strong>åŒ¹é…çš„Moduleæ•°é‡:</strong> ' + (analysis.moduleCount || 0) + '</p>' +
                '<p><strong>åŒ¹é…çš„Configæ•°é‡:</strong> ' + (analysis.configCount || 0) + '</p>';
            
            if (analysis.issues && analysis.issues.length > 0) {
                html += '<p><strong>å‘ç°çš„é—®é¢˜:</strong></p><ul>';
                analysis.issues.forEach(function(issue) {
                    html += '<li class="text-danger">' + issue + '</li>';
                });
                html += '</ul>';
            }
            
            if (analysis.suggestions && analysis.suggestions.length > 0) {
                html += '<p><strong>å»ºè®®:</strong></p><ul>';
                analysis.suggestions.forEach(function(suggestion) {
                    html += '<li class="text-success">' + suggestion + '</li>';
                });
                html += '</ul>';
            }
            
            html += '</div>';
            
            if (analysis.modules && analysis.modules.length > 0) {
                html += '<h6>åŒ¹é…çš„Module:</h6>';
                html += '<table class="table table-sm"><thead><tr><th>åº”ç”¨å</th><th>ç¯å¢ƒ</th><th>IP</th></tr></thead><tbody>';
                analysis.modules.forEach(function(module) {
                    html += '<tr><td>' + module.appName + '</td><td>' + module.environment + '</td><td>' + module.ip + '</td></tr>';
                });
                html += '</tbody></table>';
            }
            
            jq('#matching-analysis-display').html(html);
        }
        
        // ==================== K8Sç¯å¢ƒè°ƒè¯•å™¨å‡½æ•° ====================
        
        window.openK8sDebugger = function() {
            if (!jq('#k8s-debugger-modal').length) {
                createK8sDebuggerModal();
            }
            jq('#k8s-debugger-modal').modal('show');
            // è‡ªåŠ¨å¼€å§‹åˆå§‹æ£€æŸ¥
            runK8sEnvironmentCheck();
        };
        
        function createK8sDebuggerModal() {
            var modalHtml = '<div class="modal fade" id="k8s-debugger-modal" tabindex="-1">' +
                '<div class="modal-dialog modal-xl">' +
                '<div class="modal-content">' +
                '<div class="modal-header">' +
                '<h4 class="modal-title"><i class="fa fa-cloud"></i> K8Sç¯å¢ƒè°ƒè¯•å™¨</h4>' +
                '<button type="button" class="close" data-dismiss="modal">' +
                '<span aria-hidden="true">Ã—</span>' +
                '</button>' +
                '</div>' +
                '<div class="modal-body">' +
                '<div class="row">' +
                '<div class="col-md-6">' +
                '<h5><i class="fa fa-info-circle"></i> å®ä¾‹ä¿¡æ¯</h5>' +
                '<div id="k8s-instance-info">' +
                '<p class="text-muted">æ­£åœ¨æ£€æŸ¥å½“å‰å®ä¾‹ä¿¡æ¯...</p>' +
                '</div>' +
                '</div>' +
                '<div class="col-md-6">' +
                '<h5><i class="fa fa-database"></i> æ•°æ®åº“è¿æ¥</h5>' +
                '<div id="k8s-database-info">' +
                '<p class="text-muted">æ­£åœ¨æ£€æŸ¥æ•°æ®åº“è¿æ¥...</p>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '<div class="row mt-4">' +
                '<div class="col-12">' +
                '<h5><i class="fa fa-sync"></i> æ•°æ®ä¸€è‡´æ€§æµ‹è¯•</h5>' +
                '<div class="form-group">' +
                '<label>æµ‹è¯•åº”ç”¨å:</label>' +
                '<input type="text" id="k8s-test-app" class="form-control" placeholder="è¾“å…¥è¦æµ‹è¯•çš„åº”ç”¨å">' +
                '</div>' +
                '<div class="form-group">' +
                '<label>æµ‹è¯•ç¯å¢ƒ:</label>' +
                '<input type="text" id="k8s-test-env" class="form-control" placeholder="è¾“å…¥è¦æµ‹è¯•çš„ç¯å¢ƒ">' +
                '</div>' +
                '<button class="btn btn-primary" onclick="runConsistencyTest()">è¿è¡Œä¸€è‡´æ€§æµ‹è¯•</button>' +
                '<button class="btn btn-warning" onclick="runTimestampAnalysis()">æ—¶é—´æˆ³åˆ†æ</button>' +
                '<div id="k8s-consistency-result" class="mt-3">' +
                '<p class="text-muted">ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•</p>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '<div class="row mt-4">' +
                '<div class="col-12">' +
                '<h5><i class="fa fa-history"></i> å®æ—¶ç›‘æ§</h5>' +
                '<button class="btn btn-success" onclick="startRealTimeMonitoring()">å¼€å§‹ç›‘æ§</button>' +
                '<button class="btn btn-secondary" onclick="stopRealTimeMonitoring()">åœæ­¢ç›‘æ§</button>' +
                '<div id="k8s-realtime-log" class="mt-3" style="height: 200px; overflow-y: scroll; border: 1px solid #ddd; padding: 10px; background: #f8f9fa;">' +
                '<p class="text-muted">ç‚¹å‡»"å¼€å§‹ç›‘æ§"æŸ¥çœ‹å®æ—¶æ•°æ®å˜åŒ–</p>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '<div class="modal-footer">' +
                '<button type="button" class="btn btn-secondary" data-dismiss="modal">å…³é—­</button>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>';
            jq('body').append(modalHtml);
        }
        
        var k8sMonitorInterval = null;
        var k8sTestCounter = 0;
        
        function runK8sEnvironmentCheck() {
            // æ£€æŸ¥å®ä¾‹ä¿¡æ¯
            jq('#k8s-instance-info').html('<i class="fa fa-spinner fa-spin"></i> æ£€æŸ¥ä¸­...');
            jq.ajax({
                url: '/config/k8sInstanceInfo.json',
                method: 'GET',
                success: function(response) {
                    if (response.success && response.data) {
                        displayK8sInstanceInfo(response.data);
                    } else {
                        jq('#k8s-instance-info').html('<p class="text-danger">è·å–å®ä¾‹ä¿¡æ¯å¤±è´¥: ' + (response.message || 'æœªçŸ¥é”™è¯¯') + '</p>');
                    }
                },
                error: function() {
                    // ä½¿ç”¨å‰ç«¯æ–¹æ³•è·å–åŸºæœ¬ä¿¡æ¯
                    var info = {
                        userAgent: navigator.userAgent,
                        currentUrl: window.location.href,
                        timestamp: new Date().toISOString(),
                        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
                    };
                    displayK8sInstanceInfo(info);
                }
            });
            
            // æ£€æŸ¥æ•°æ®åº“è¿æ¥ä¿¡æ¯
            jq('#k8s-database-info').html('<i class="fa fa-spinner fa-spin"></i> æ£€æŸ¥ä¸­...');
            jq.ajax({
                url: '/config/k8sDatabaseInfo.json',
                method: 'GET',
                success: function(response) {
                    if (response.success && response.data) {
                        displayK8sDatabaseInfo(response.data);
                    } else {
                        jq('#k8s-database-info').html('<p class="text-danger">è·å–æ•°æ®åº“ä¿¡æ¯å¤±è´¥: ' + (response.message || 'æœªçŸ¥é”™è¯¯') + '</p>');
                    }
                },
                error: function() {
                    jq('#k8s-database-info').html('<p class="text-warning">æ— æ³•è·å–æ•°æ®åº“è¯¦ç»†ä¿¡æ¯ï¼Œè¯·æ£€æŸ¥åç«¯API</p>');
                }
            });
        }
        
        function displayK8sInstanceInfo(info) {
            var html = '<table class="table table-sm">';
            html += '<tr><td><strong>å½“å‰URL:</strong></td><td>' + (info.currentUrl || window.location.href) + '</td></tr>';
            html += '<tr><td><strong>æ—¶é—´æˆ³:</strong></td><td>' + (info.timestamp || new Date().toISOString()) + '</td></tr>';
            html += '<tr><td><strong>æ—¶åŒº:</strong></td><td>' + (info.timezone || 'Unknown') + '</td></tr>';
            if (info.podName) html += '<tr><td><strong>Podåç§°:</strong></td><td>' + info.podName + '</td></tr>';
            if (info.nodeId) html += '<tr><td><strong>èŠ‚ç‚¹ID:</strong></td><td>' + info.nodeId + '</td></tr>';
            if (info.instanceId) html += '<tr><td><strong>å®ä¾‹ID:</strong></td><td>' + info.instanceId + '</td></tr>';
            html += '</table>';
            jq('#k8s-instance-info').html(html);
        }
        
        function displayK8sDatabaseInfo(info) {
            var html = '<table class="table table-sm">';
            html += '<tr><td><strong>æ•°æ®åº“URL:</strong></td><td><small>' + (info.databaseUrl || 'Unknown') + '</small></td></tr>';
            html += '<tr><td><strong>è¿æ¥æ± çŠ¶æ€:</strong></td><td>' + (info.connectionPoolStatus || 'Unknown') + '</td></tr>';
            html += '<tr><td><strong>æ€»è®°å½•æ•°:</strong></td><td>Config: ' + (info.configCount || '?') + ', Module: ' + (info.moduleCount || '?') + '</td></tr>';
            html += '<tr><td><strong>æœ€æ–°è®°å½•æ—¶é—´:</strong></td><td>' + (info.latestRecordTime || 'Unknown') + '</td></tr>';
            html += '</table>';
            jq('#k8s-database-info').html(html);
        }
        
        window.runConsistencyTest = function() {
            var appName = jq('#k8s-test-app').val().trim();
            var environment = jq('#k8s-test-env').val().trim();
            
            if (!appName || !environment) {
                jq('#k8s-consistency-result').html('<p class="text-warning">è¯·å¡«å†™åº”ç”¨åå’Œç¯å¢ƒ</p>');
                return;
            }
            
            jq('#k8s-consistency-result').html('<i class="fa fa-spinner fa-spin"></i> æ­£åœ¨è¿›è¡Œä¸€è‡´æ€§æµ‹è¯•...');
            
            var testResults = [];
            var testCount = 5; // è¿›è¡Œ5æ¬¡æµ‹è¯•
            var currentTest = 0;
            
            function runSingleTest() {
                currentTest++;
                jq.ajax({
                    url: '/config/debugMatching.json',
                    method: 'GET',
                    data: { appName: appName, environment: environment },
                    success: function(response) {
                        testResults.push({
                            test: currentTest,
                            timestamp: new Date().toISOString(),
                            success: response.success,
                            moduleCount: response.success && response.data ? response.data.moduleCount : 0,
                            configCount: response.success && response.data ? response.data.configCount : 0,
                            response: response
                        });
                        
                        if (currentTest < testCount) {
                            // ç­‰å¾…1ç§’åè¿›è¡Œä¸‹ä¸€æ¬¡æµ‹è¯•
                            setTimeout(runSingleTest, 1000);
                        } else {
                            // æ‰€æœ‰æµ‹è¯•å®Œæˆï¼Œåˆ†æç»“æœ
                            analyzeConsistencyResults(testResults);
                        }
                    },
                    error: function() {
                        testResults.push({
                            test: currentTest,
                            timestamp: new Date().toISOString(),
                            success: false,
                            error: 'APIè°ƒç”¨å¤±è´¥'
                        });
                        
                        if (currentTest < testCount) {
                            setTimeout(runSingleTest, 1000);
                        } else {
                            analyzeConsistencyResults(testResults);
                        }
                    }
                });
            }
            
            runSingleTest();
        };
        
        function analyzeConsistencyResults(results) {
            var html = '<div class="alert alert-info">';
            html += '<h6><i class="fa fa-chart-line"></i> æ•°æ®ä¸€è‡´æ€§æµ‹è¯•ç»“æœ</h6>';
            
            var successCount = results.filter(function(r) { return r.success; }).length;
            var moduleCountSet = new Set();
            var configCountSet = new Set();
            
            results.forEach(function(result) {
                if (result.success) {
                    moduleCountSet.add(result.moduleCount);
                    configCountSet.add(result.configCount);
                }
            });
            
            html += '<p><strong>æˆåŠŸç‡:</strong> ' + successCount + '/' + results.length + ' (' + ((successCount/results.length)*100).toFixed(1) + '%)</p>';
            html += '<p><strong>Moduleæ•°é‡å˜åŒ–:</strong> ' + Array.from(moduleCountSet).join(', ') + (moduleCountSet.size > 1 ? ' <span class="text-danger">[ä¸ä¸€è‡´!]</span>' : ' <span class="text-success">[ä¸€è‡´]</span>') + '</p>';
            html += '<p><strong>Configæ•°é‡å˜åŒ–:</strong> ' + Array.from(configCountSet).join(', ') + (configCountSet.size > 1 ? ' <span class="text-danger">[ä¸ä¸€è‡´!]</span>' : ' <span class="text-success">[ä¸€è‡´]</span>') + '</p>';
            
            html += '</div>';
            
            html += '<h6>è¯¦ç»†æµ‹è¯•è®°å½•:</h6>';
            html += '<table class="table table-sm table-striped">';
            html += '<thead><tr><th>æµ‹è¯•</th><th>æ—¶é—´</th><th>æˆåŠŸ</th><th>Module</th><th>Config</th></tr></thead>';
            html += '<tbody>';
            
            results.forEach(function(result) {
                html += '<tr>';
                html += '<td>' + result.test + '</td>';
                html += '<td>' + result.timestamp.substring(11, 19) + '</td>';
                html += '<td>' + (result.success ? '<span class="text-success">æ˜¯</span>' : '<span class="text-danger">å¦</span>') + '</td>';
                html += '<td>' + (result.moduleCount || 'N/A') + '</td>';
                html += '<td>' + (result.configCount || 'N/A') + '</td>';
                html += '</tr>';
            });
            
            html += '</tbody></table>';
            
            // åˆ†æå’Œå»ºè®®
            if (moduleCountSet.size > 1 || configCountSet.size > 1) {
                html += '<div class="alert alert-danger">';
                html += '<h6>âŒ å‘ç°æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼</h6>';
                html += '<p><strong>å¯èƒ½åŸå› :</strong></p>';
                html += '<ul>';
                html += '<li>ä¸åŒPodè¿æ¥åˆ°ä¸åŒçš„æ•°æ®åº“å®ä¾‹</li>';
                html += '<li>æ•°æ®åº“è¯»å†™åˆ†ç¦»å¯¼è‡´çš„å»¶è¿Ÿ</li>';
                html += '<li>è´Ÿè½½å‡è¡¡å™¨å°†è¯·æ±‚åˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡å®ä¾‹</li>';
                html += '<li>ç¼“å­˜ä¸ä¸€è‡´</li>';
                html += '</ul>';
                html += '</div>';
            } else if (successCount === results.length && moduleCountSet.size === 1 && configCountSet.size === 1) {
                html += '<div class="alert alert-success">';
                html += '<h6>âœ… æ•°æ®ä¸€è‡´æ€§æ­£å¸¸</h6>';
                html += '<p>æ‰€æœ‰æµ‹è¯•ç»“æœä¸€è‡´ï¼Œé—®é¢˜å¯èƒ½å‡ºç°åœ¨å…¶ä»–æ–¹é¢ã€‚</p>';
                html += '</div>';
            }
            
            jq('#k8s-consistency-result').html(html);
        }
        
        window.runTimestampAnalysis = function() {
            jq('#k8s-consistency-result').html('<i class="fa fa-spinner fa-spin"></i> æ­£åœ¨åˆ†ææ—¶é—´æˆ³...');
            
            jq.ajax({
                url: '/config/debugQuery.json',
                method: 'GET',
                success: function(configResponse) {
                    jq.ajax({
                        url: '/module/debugQuery.json',
                        method: 'GET',
                        success: function(moduleResponse) {
                            analyzeTimestamps(configResponse.data, moduleResponse.data);
                        },
                        error: function() {
                            jq('#k8s-consistency-result').html('<p class="text-danger">è·å–Moduleæ•°æ®å¤±è´¥</p>');
                        }
                    });
                },
                error: function() {
                    jq('#k8s-consistency-result').html('<p class="text-danger">è·å–Configæ•°æ®å¤±è´¥</p>');
                }
            });
        };
        
        function analyzeTimestamps(configs, modules) {
            var html = '<div class="alert alert-info">';
            html += '<h6><i class="fa fa-clock"></i> æ—¶é—´æˆ³åˆ†æç»“æœ</h6>';
            
            var now = new Date();
            var configTimes = configs.map(function(c) { return new Date(c.gmtModified || c.gmtCreate); });
            var moduleTimes = modules.map(function(m) { return new Date(m.gmtModified || m.gmtCreate); });
            
            var latestConfig = Math.max.apply(null, configTimes);
            var latestModule = Math.max.apply(null, moduleTimes);
            
            html += '<p><strong>æœ€æ–°Configæ—¶é—´:</strong> ' + new Date(latestConfig).toISOString() + '</p>';
            html += '<p><strong>æœ€æ–°Moduleæ—¶é—´:</strong> ' + new Date(latestModule).toISOString() + '</p>';
            html += '<p><strong>å½“å‰æ—¶é—´:</strong> ' + now.toISOString() + '</p>';
            
            var configDelay = (now - latestConfig) / 1000;
            var moduleDelay = (now - latestModule) / 1000;
            
            html += '<p><strong>Configæ•°æ®å»¶è¿Ÿ:</strong> ' + configDelay.toFixed(1) + ' ç§’</p>';
            html += '<p><strong>Moduleæ•°æ®å»¶è¿Ÿ:</strong> ' + moduleDelay.toFixed(1) + ' ç§’</p>';
            
            if (configDelay > 300 || moduleDelay > 300) {
                html += '<div class="alert alert-warning">';
                html += '<p>âš ï¸ æ£€æµ‹åˆ°è¾ƒé•¿çš„æ•°æ®å»¶è¿Ÿï¼Œå¯èƒ½å­˜åœ¨æ•°æ®åŒæ­¥é—®é¢˜ã€‚</p>';
                html += '</div>';
            }
            
            html += '</div>';
            jq('#k8s-consistency-result').html(html);
        }
        
        window.startRealTimeMonitoring = function() {
            if (k8sMonitorInterval) {
                clearInterval(k8sMonitorInterval);
            }
            
            k8sTestCounter = 0;
            jq('#k8s-realtime-log').html('<p class="text-info">å¼€å§‹å®æ—¶ç›‘æ§...</p>');
            
            k8sMonitorInterval = setInterval(function() {
                k8sTestCounter++;
                var timestamp = new Date().toISOString();
                
                jq.ajax({
                    url: '/config/debugQuery.json',
                    method: 'GET',
                    success: function(response) {
                        var configCount = response.success && response.data ? response.data.length : 0;
                        
                        jq.ajax({
                            url: '/module/debugQuery.json',
                            method: 'GET',
                            success: function(moduleResponse) {
                                var moduleCount = moduleResponse.success && moduleResponse.data ? moduleResponse.data.length : 0;
                                
                                var logEntry = '<div style="border-bottom: 1px solid #eee; padding: 5px 0;">';
                                logEntry += '<span class="text-muted">[' + timestamp.substring(11, 19) + ']</span> ';
                                logEntry += 'Config: ' + configCount + ', Module: ' + moduleCount;
                                logEntry += '</div>';
                                
                                jq('#k8s-realtime-log').prepend(logEntry);
                                
                                // ä¿æŒæœ€å¤š50æ¡è®°å½•
                                var entries = jq('#k8s-realtime-log div');
                                if (entries.length > 50) {
                                    entries.slice(50).remove();
                                }
                            }
                        });
                    }
                });
            }, 5000); // æ¯5ç§’æ£€æŸ¥ä¸€æ¬¡
        };
        
        window.stopRealTimeMonitoring = function() {
            if (k8sMonitorInterval) {
                clearInterval(k8sMonitorInterval);
                k8sMonitorInterval = null;
            }
            jq('#k8s-realtime-log').prepend('<p class="text-warning">ç›‘æ§å·²åœæ­¢</p>');
        };
        
        // ==================== jQuery DOM Ready äº‹ä»¶ç»‘å®š ====================
        
        jq(function () {
            jq(".btn-push").on('click', function () {
                var appName = jq(this).attr('data-app');
                var environment = jq(this).attr('data-env');
                
                // æ˜¾ç¤ºè°ƒè¯•é¢æ¿å¹¶è®°å½•æ¨é€å‚æ•°
                showConfigDebugPanel();
                logPushParams(appName, environment);
                
                // å…ˆæŸ¥è¯¢åŒ¹é…çš„æ¨¡å—
                checkModuleMatches(appName, environment, function(matchResult) {
                    logModuleMatches(matchResult);
                    
                    if (matchResult.hasMatches) {
                        // æœ‰åŒ¹é…çš„æ¨¡å—ï¼Œæ‰§è¡Œæ¨é€
                        executePushConfig(appName, environment);
                    } else {
                        // æ²¡æœ‰åŒ¹é…çš„æ¨¡å—ï¼Œæ˜¾ç¤ºè¯¦ç»†åŸå› 
                        showNoMatchReason(matchResult.reason, matchResult.suggestions);
                    }
                });
            })
        });
    
    function createEnvironmentCheckerModal() {
        var modalHtml = '<div class="modal fade" id="environment-checker-modal" tabindex="-1">' +
            '<div class="modal-dialog modal-lg">' +
            '<div class="modal-content">' +
            '<div class="modal-header bg-info">' +
            '<h4 class="modal-title">' +
            '<i class="fa fa-check-circle"></i> Environmentä¸€è‡´æ€§æ£€æŸ¥å™¨' +
            '</h4>' +
            '<button type="button" class="close" data-dismiss="modal">' +
            '<span>Ã—</span>' +
            '</button>' +
            '</div>' +
            '<div class="modal-body">' +
            '<div id="environment-check-content">' +
            '<!-- æ£€æŸ¥ç»“æœå†…å®¹ -->' +
            '</div>' +
            '</div>' +
            '<div class="modal-footer">' +
            '<button type="button" class="btn btn-primary" onclick="runEnvironmentCheck()">' +
            '<i class="fa fa-refresh"></i> é‡æ–°æ£€æŸ¥' +
            '</button>' +
            '<button type="button" class="btn btn-success" onclick="autoFixEnvironments()" id="auto-fix-btn" style="display:none;">' +
            '<i class="fa fa-magic"></i> è‡ªåŠ¨ä¿®å¤' +
            '</button>' +
            '<button type="button" class="btn btn-secondary" data-dismiss="modal">å…³é—­</button>' +
            '</div>' +
            '</div>' +
            '</div>' +
            '</div>';
        jq('body').append(modalHtml);
    }
    
    function runEnvironmentCheck() {
        var jqcontent = jq('#environment-check-content');
        jqcontent.html('<div class=\"text-center\"><i class=\"fa fa-spinner fa-spin\"></i> æ­£åœ¨æ£€æŸ¥...</div>');
        
        jq.ajax({
            url: '/config/checkEnvironments.json',
            method: 'GET',
            success: function(response) {
                if (response.success) {
                    displayEnvironmentCheckResult(response.data);
                } else {
                    jqcontent.html('<div class=\"alert alert-danger\">æ£€æŸ¥å¤±è´¥: ' + response.message + '</div>');
                }
            },
            error: function() {
                jqcontent.html('<div class=\"alert alert-danger\">æ£€æŸ¥å¤±è´¥ï¼Œè¯·é‡è¯•</div>');
            }
        });
    }
    
    function displayEnvironmentCheckResult(data) {
        var html = '';
        
        // æ€»ä½“çŠ¶æ€
        if (data.hasIssues) {
            html += '<div class="alert alert-warning">' +
                '<h5><i class="fa fa-exclamation-triangle"></i> å‘ç°Environmentä¸åŒ¹é…é—®é¢˜</h5>' +
                '<p>å‘ç° ' + data.issueCount + ' ä¸ªä¸åŒ¹é…çš„Configé…ç½®</p>' +
                '</div>';
            jq('#auto-fix-btn').show();
        } else {
            html += '<div class="alert alert-success">' +
                '<h5><i class="fa fa-check"></i> Environmenté…ç½®æ­£å¸¸</h5>' +
                '<p>æ‰€æœ‰Configçš„Environmentéƒ½æœ‰å¯¹åº”çš„æ¨¡å—</p>' +
                '</div>';
            jq('#auto-fix-btn').hide();
        }
        
        // è¯¦ç»†çš„åŒ¹é…è¡¨
        if (data.details && data.details.length > 0) {
            html += '<h5>ğŸ“‹ è¯¦ç»†åŒ¹é…æƒ…å†µ</h5>';
            html += '<table class="table table-sm table-striped">' +
                '<thead>' +
                '<tr>' +
                '<th>Config (AppName)</th>' +
                '<th>Config Environment</th>' +
                '<th>åŒ¹é…çŠ¶æ€</th>' +
                '<th>å¯ç”¨çš„Module Environments</th>' +
                '<th>å»ºè®®</th>' +
                '</tr>' +
                '</thead>' +
                '<tbody>';
            
            data.details.forEach(function(item) {
                var statusClass = item.matched ? 'text-success' : 'text-danger';
                var statusIcon = item.matched ? 'fa-check' : 'fa-times';
                var statusText = item.matched ? 'åŒ¹é…' : 'ä¸åŒ¹é…';
                
                var envBadges = '';
                for (var i = 0; i < item.availableEnvironments.length; i++) {
                    envBadges += '<span class="badge badge-secondary">' + item.availableEnvironments[i] + '</span> ';
                }
                
                html += '<tr>' +
                    '<td>' + item.configAppName + '</td>' +
                    '<td><span class="badge badge-primary">' + item.configEnvironment + '</span></td>' +
                    '<td class="' + statusClass + '">' +
                    '<i class="fa ' + statusIcon + '"></i> ' + statusText +
                    '</td>' +
                    '<td>' + envBadges + '</td>' +
                    '<td>' + item.suggestion + '</td>' +
                    '</tr>';
            });
            
            html += '</tbody></table>';
        }
        
        jq('#environment-check-content').html(html);
    }
        
</script>

<!-- è°ƒè¯•é¢æ¿æ ·å¼ -->
<style>
    .debug-content {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        padding: 10px;
        min-height: 100px;
    }
    
    .debug-log {
        background: #1e1e1e;
        color: #f8f9fa;
        border-radius: 4px;
        padding: 10px;
        height: 200px;
        overflow-y: auto;
        font-family: 'Courier New', monospace;
        font-size: 12px;
    }
    
    .debug-log-entry {
        margin-bottom: 5px;
        padding: 2px 5px;
        border-radius: 2px;
        line-height: 1.4;
    }
    
    .param-item {
        background: white;
        border: 1px solid #e9ecef;
        border-radius: 3px;
        padding: 8px;
    }
</style>

</body>
</html>